#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
#	ファイル名	：	/Mul_light/Makefile
#	概要		：	OSのMakefileです。
#	詳細		：
#	責任者		：	佐合 秀昭
#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#



#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
#	変数定義
#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
ROOT				= ../

NAME				= $(OS_NAME)

#バイナリ名
BOOT_SECT_BIN		= BootSector.bin
BOOT_LOAD_BIN		= BootLoader.bin
KERNEL_BIN			= Kernel.bin

#ディレクトリ名
BOOT_SECT_DIR		= Boot/BootSector/
BOOT_LOAD_DIR		= Boot/BootLoader/
KERNEL_DIR			= Kernel/



#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
#	インクルード
#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
include	$(ROOT)Common.mk



#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
#	コマンド
#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
#*******************************************************************************
#	デフォルトコマンド
#*******************************************************************************
PHONY += default _default
default:
	@make -s _$@
_default: _image


#*******************************************************************************
#	イメージ作成
#*******************************************************************************
PHONY += image img _image _img
image img:
	@make -s _$@
_image _img: $(IMG_NAME)



#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
#	ファイル生成規則
#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
#*******************************************************************************
#	OSイメージ作成		ブートセクタ(.bin) + ブートローダ(.bin) + カーネル(.bin) -> OSイメージ(.img)
#*******************************************************************************
PHONY += $(IMG_NAME)
$(IMG_NAME):
	@echo
	@echo ■ブートセクタ作成
	make -C $(BOOT_SECT_DIR) _binary
	@echo
	@echo ■ブートローダ作成
	make -C $(BOOT_LOAD_DIR) _binary
	@echo
	@echo ■カーネル作成
	make -C $(KERNEL_DIR) _binary

	@echo -e "\tcat\t$@"
	rm -f $@
	cat	$(BOOT_SECT_DIR)$(BOOT_SECT_BIN)\
		$(BOOT_LOAD_DIR)$(BOOT_LOAD_BIN)\
		$(KERNEL_DIR)$(KERNEL_BIN) > $@



.PHONY:	$(PHONY)
#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#
#	End of file
#■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■#

